# Encoding URL
---
## 1. Hashing the URL and Timestamp:
- A unique hash is generated by concatenating the original URL with the current timestamp.
- The system uses **SHA-256** hashing to create a unique and fixed-length hash. This ensures that even small changes in the URL or timestamp result in a completely different hash.

## 2. Modulo Operation:
- The resulting hash (in hexadecimal format) is converted into an integer, and then a modulo operation is applied. This operation ensures that the resulting number falls within a range defined by the maximum possible short code length.
- The modulo is calculated as `hash % max_value`, where `max_value` is determined based on the total number of codes and the length of the desired short code.

## 3. Base62 Encoding:
- The result of the modulo operation is then converted into a **Base62** encoded string. Base62 encoding uses a set of 62 characters (0-9, a-z, A-Z), which helps represent numbers in a compact form, making the short URL both short and URL-safe.
- Base62 encoding is efficient because it uses a higher base than traditional Base64, allowing for more compact representations of large numbers.

## 4. Token Size Calculation:
- The length of the short code (token size) is dynamically calculated based on the total number of generated short URLs. The system uses the logarithm of the total count in base 62 to determine the appropriate length of the short code. This ensures that the short code grows in size as more URLs are shortened, preventing potential collisions.
- The minimum length of the short code is set to a predefined value (`MIN_TOKEN_LENGTH`), ensuring that the short URL is always long enough to be unique.

# Retry on Collision (Ensuring Uniqueness):
---
Even though the hashing and timestamp drastically reduce the chance of collisions, they can still occur, especially under:
- High traffic
- Identical URLs sent in the same second

To handle this, the application implements a retry mechanism:
- If creating the short link fails due to a uniqueness conflict **(ActiveRecord::RecordNotUnique)**, it will:
  - Log a warning
  - Regenerate a new short code with an updated timestamp or hash
  - Retry the creation up to a fixed number of times (e.g., 3 attempts)

# Decoding URL
---
## 1. Validate Domain:
- Ensure the URL starts with the expected domain.
## 2. Extract Code:
- Remove the domain from the URL to retrieve the unique code.
## 3. Find Short Link:
- Look up the short link in the database using the extracted code.
## 4. Validate Short Link:
- Check if the short link exists. If not, raise an error.
## 5. Return Original URL:
- If valid, return the original URL associated with the short code.
